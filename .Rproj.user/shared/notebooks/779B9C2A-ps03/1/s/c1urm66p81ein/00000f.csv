"0","#| label: data cleaning"
"0",""
"0","ep_raw_clean <- ep_raw |> "
"0","  separate(col = ""Страна"", into = c(""countryname_ru"", ""countryname_en""),"
"0","           sep = "" / "") |> "
"0","  separate(col = ""Город"", into = c(""city_ru"", ""city_en""), "
"0","           sep = "" / "") |> "
"0","  mutate(countryname_en = if_else(countryname_en == ""Czech"", "
"0","                                  ""Czechia"", countryname_en),"
"0","         countrycode_n = countrycode(countryname_en, "
"0","                                     origin = ""country.name"", "
"0","                                     destination = ""iso3n""),"
"0","         countrycode_c = countrycode(countrycode_n, "
"0","                                     origin = ""iso3n"", "
"0","                                     destination = ""iso3c""),"
"0","         voting_station = as.character(`УИК`),"
"0","         city_en = if_else(str_detect(city_ru, ""№"") == T, "
"0","                           paste(city_en, str_sub(city_ru, -1, "
"0","                                                  nchar(city_ru))),"
"0","                           city_en)) |> "
"0","  transmute(volunteer_id = `ID волонтера`,"
"0","            data_source = case_when("
"0","            `Источник данных` == ""Электронная анкета избирателя по одноразовым QR кодам"""
"0","            ~ ""One-off QR e-form"","
"0","            `Источник данных` == ""Общая электронная анкета"" ~ ""General e-form"","
"0","            `Источник данных` == ""Электронная анкета - Токио"" ~ ""Tokio e-form"","
"0","            `Источник данных` == ""Электронная анкета - Стокгольм"" ~ ""Stockholm e-form"","
"0","            `Источник данных` == ""Электронная анкета - Прага"" ~ ""Prague e-form"","
"0","            `Источник данных` == ""Электронная анкета - Дубай"" ~ ""Dubai e-form"","
"0","            `Источник данных` == ""Статистика ответов - Веллингтон"" ~ ""Wellington e-form"","
"0","            `Источник данных` == ""Статистика ответов - Сидней"" ~ ""Sydney e-form""),"
"0","            upload_time = ymd_hms(`Отметка времени`),"
"0","            countryname_en, countryname_ru, city_ru, city_en, countrycode_c, countrycode_n,"
"0","            voting_station, "
"0","            vote = case_when("
"0","              `За какого кандидата вы проголосовали?` == ""В. А. Даванков"" ~ ""Davankov"","
"0","              `За какого кандидата вы проголосовали?` == ""Л.В. Слуцкий"" ~ ""Slutsky"","
"0","              `За какого кандидата вы проголосовали?`"
"0","              == ""Недействительный бюллетень (ни одной галочки, несколько галочек)"""
"0","              ~ ""Spoiled ballot"","
"0","              `За какого кандидата вы проголосовали?` == ""Бюллетень унесён/выброшен/порван"""
"0","              ~ ""Tore up/took"","
"0","              `За какого кандидата вы проголосовали?` == ""В.В. Путин"" ~ ""Putin"","
"0","              `За какого кандидата вы проголосовали?` == ""Не хочу отвечать"""
"0","              ~ ""Declined to answer"","
"0","              `За какого кандидата вы проголосовали?` == ""Н.М. Харитонов"" ~ ""Haritonov"""
"0","              ),"
"0","            sex = case_when(`Ваш пол` == ""Мужской"" ~ ""Male"","
"0","                            `Ваш пол` == ""Женский"" ~ ""Female"","
"0","                            `Ваш пол` == ""Другое"" ~ ""Other"","
"0","                            `Ваш пол` == ""Не хочу отвечать"" ~ ""Declined to answer"","
"0","                            .default = NA),"
"0","            age_bin = case_when("
"0","              `Возрастная группа` == ""Не хочу отвечать"" ~ ""Declined to answer"","
"0","              .default = `Возрастная группа`),"
"0","            out_of_Russia_time = case_when("
"0","              `Как давно вы не живете в России?` == ""Меньше 6 месяцев""~ ""< 6 months"","
"0","              `Как давно вы не живете в России?` == ""6 месяцев - 2 года (после февраля 2022)"""
"0","              ~ ""6 months - 2 years"","
"0","              `Как давно вы не живете в России?` == ""Менее 2 лет"" ~ ""< 2 years"","
"0","              `Как давно вы не живете в России?` == ""2 - 5 лет"" ~ ""2 - 5 years"","
"0","              `Как давно вы не живете в России?` == ""Более 5 лет"" ~ ""> 5 years"","
"0","              `Как давно вы не живете в России?` == ""6-10 лет""~ ""6 - 10 years"","
"0","              `Как давно вы не живете в России?` == ""Более 10 лет"" ~ ""> 10 years"","
"0","              `Как давно вы не живете в России?` == ""Не хочу отвечать"""
"0","              ~ ""Declined to answer"","
"0","              `Как давно вы не живете в России?` == ""Турист/ка (живу в РФ)"""
"0","              ~ ""Tourist (lives in Russia)"", .default = NA),"
"0","            time_to_vs = case_when("
"0","              `Как долго вы добирались до избирательного участка?` == ""<30 минут"" "
"0","              ~ ""<30 minutes"" ,"
"0","              `Как долго вы добирались до избирательного участка?` == ""30 мин - 1 час"" "
"0","              ~ ""30 minutes - 1 hour"" ,"
"0","              `Как долго вы добирались до избирательного участка?` == ""1 - 2 часа"""
"0","              ~ ""1 - 2 hours"","
"0","              `Как долго вы добирались до избирательного участка?` == ""2 - 3 часа"""
"0","              ~ ""2 - 3 hours"","
"0","              `Как долго вы добирались до избирательного участка?` == ""3 - 4 часа"""
"0","              ~ ""3 - 4 hours"","
"0","              `Как долго вы добирались до избирательного участка?` == ""Более 2 часов"""
"0","              ~ ""> 2 hours"" ,"
"0","              `Как долго вы добирались до избирательного участка?`"
"0","              == ""Более 4 часов (остаюсь ночевать в этом городе)"""
"0","              ~ ""> 4 hours (staying for the night)"","
"0","              `Как долго вы добирались до избирательного участка?` == ""Не хочу отвечать"""
"0","              ~ ""Declined to answer"", .default = NA),"
"0","            result_trust = case_when("
"0","              `Вы доверяете результатам выборов в России?` %in% c(""Точно нет"", ""Точно НЕТ"")"
"0","              ~ ""Definitely no"","
"0","              `Вы доверяете результатам выборов в России?` == ""Скорее НЕ доверяю"""
"0","              ~ ""Probably no"","
"0","              `Вы доверяете результатам выборов в России?` == ""Скорее доверяю"""
"0","              ~ ""Probably yes"","
"0","              `Вы доверяете результатам выборов в России?` %in% c(""Точно да"", ""Точно ДА"")"
"0","              ~ ""Definitely yes"","
"0","              `Вы доверяете результатам выборов в России?` == ""Затрудняюсь ответить"""
"0","              ~ ""Don't know"","
"0","              `Вы доверяете результатам выборов в России?` == ""Не хочу отвечать"""
"0","              ~ ""Declined to answer"", .default = NA),"
"0","            uik_closetime = `УИК - Время закрытия участка (CET)`,"
"0","            uik_nvoters = `УИК - Человек посчитано на выходе`,"
"0","            uik_didntvote_closed = `УИК - Человек не успели голосовать до закрытия`,"
"0","            id = row_number())"
