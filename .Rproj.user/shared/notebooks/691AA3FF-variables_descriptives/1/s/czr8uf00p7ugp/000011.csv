"0","#| label: adjusting time out of Russia"
"0",""
"0","ep_raw_out <- ep_raw_tvs |> "
"0","  mutate(out_of_Russia_time = case_when("
"0","    out_of_Russia_time %in% c(""< 6 months"", ""6 months - 2 years"", ""< 2 years"") ~ ""After invasion"","
"0","    out_of_Russia_time %in% c(""> 5 years"", ""6 - 10 years"") ~ ""After annexation"","
"0","    out_of_Russia_time == ""> 10 years"" ~ ""Before annexation"", "
"0","    out_of_Russia_time == ""Declined to answer"" | is.na(out_of_Russia_time) ~ ""No Data"","
"0","    .default = out_of_Russia_time))"
"0",""
"0","ep_raw_out |> "
"0","  filter(!countryname_en %in% c(""Australia"", ""New Zealand"")) |> "
"0","  group_by(out_of_Russia_time) |> "
"0","  summarise(n = n()) |> "
"0","  mutate(pct = round(n/sum(n), 4),"
"0","         lbl = if_else(pct < 0.01, NA, scales::percent(pct)),"
"0","         out_of_Russia_time = factor(out_of_Russia_time,"
"0","           levels = c(""After invasion"", ""2 - 5 years"", ""After annexation"","
"0","                      ""Before annexation"", ""Tourist (lives in Russia)"", ""No Data""))) |> "
"0","  ggplot(aes(x = n, y = out_of_Russia_time,"
"0","             fill = out_of_Russia_time)) +"
"0","    geom_bar(stat = ""identity"", color = ""black"") +"
"0","    geom_text(aes(label = lbl), size = 3, position = position_stack(vjust = 0.5)) +"
"0","    scale_fill_manual(values = c(""#FFC374"", ""#b3c58b"", ""#7F9F80"", "
"0","                                 ""#124076"", ""#872c76"", ""#bf212f"", ""#bf212f"")) +"
"0","    scale_x_continuous(limits = c(0, 30000),"
"0","                       breaks = seq(0, 30000, 5000)) +"
"0","    labs(x = ""\nNumber of respondents"","
"0","         y = """","
"0","         title = ""Time living outside of Russia, adjusted"","
"0","         subtitle = ""N = 68.593 with Australia and NZ excluded"") +"
"0","    theme_minimal() +"
"0","    theme(legend.position = ""none"")"
