"0","#| label: prepare data for mixed logit"
"0",""
"0","# Drop Australia and New Zealand for this because they have very skewed and low "
"0","# n observations. Might also help with convergence"
"0","nested_me_data <- model_data |>"
"0","  filter(vote != ""Tore up/took"", !countryname_en %in% c(""Australia"","
"0","                                                        ""New Zealand"")) |>"
"0","  mutate(non_answer = if_else(vote == ""Declined to answer"", 1, 0),"
"0","         putin_else = case_when(vote == ""Putin"" ~ 1,"
"0","                                vote %in% c(""Davankov"", ""Spoiled ballot"","
"0","                                            ""Slutsky"", ""Haritonov"") ~ 0,"
"0","                                .default = NA),"
"0","         nonsys_sys = case_when(vote %in% c(""Davankov"", ""Spoiled ballot"") ~ 1,"
"0","                                vote %in% c(""Slutsky"", ""Haritonov"") ~ 0,"
"0","                                .default = NA),"
"0","         davankov_spoiled = case_when(vote == ""Davankov"" ~ 1,"
"0","                                      vote == ""Spoiled ballot"" ~ 0,"
"0","                                      .default = NA),"
"0","         slutsky_haritonov = case_when(vote == ""Slutsky"" ~ 1,"
"0","                                       vote == ""Haritonov"" ~ 0,"
"0","                                       .default = NA)) |> "
"0","  left_join(data_country, by = c(""countrycode_n"", ""countrycode_c""))"
