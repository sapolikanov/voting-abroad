ggplot(aes(x = result_trust_bin, y = share, fill = imputed)) +
geom_bar(stat = "identity", position = position_dodge(preserve = "single"),
width = 0.5) +
facet_wrap(~ countryname_en) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 90))
imp1_cmp |>
mutate(na = if_else(is.na(result_trust_bin)[imp == "Observed"] & !is.na(imp == "1"), 1, 0)) |>
filter(na == TRUE | imp == "Observed") |>
group_by(countryname_en, imputed, result_trust_bin) |>
summarize(n = n(),
country_na = any(na == 1)) |>
drop_na() |>
group_by(countryname_en) |>
filter(!all(country_na == FALSE)) |>
group_by(countryname_en, imputed) |>
mutate(share = n/sum(n)) |>
ggplot(aes(x = result_trust_bin, y = share, fill = imputed)) +
geom_bar(stat = "identity", position = position_dodge(preserve = "single"),
width = 0.5) +
facet_wrap(~ countryname_en) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 90, hjust = 1))
imp1_cmp |>
mutate(na = if_else(is.na(result_trust_bin)[imp == "Observed"] & !is.na(imp == "1"), 1, 0)) |>
filter(na == TRUE | imp == "Observed") |>
group_by(countryname_en, imputed, result_trust_bin) |>
summarize(n = n(),
country_na = any(na == 1)) |>
drop_na() |>
group_by(countryname_en) |>
filter(!all(country_na == FALSE)) |>
group_by(countryname_en, imputed) |>
mutate(share = n/sum(n)) |>
ggplot(aes(x = result_trust_bin, y = share, fill = imputed)) +
geom_bar(stat = "identity", position = position_dodge(preserve = "single"),
width = 0.5) +
facet_wrap(~ countryname_en) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 90, hjust = 0))
imp1_cmp |>
mutate(na = if_else(is.na(result_trust_bin)[imp == "Observed"] & !is.na(imp == "1"), 1, 0)) |>
filter(na == TRUE | imp == "Observed") |>
group_by(countryname_en, imputed, result_trust_bin) |>
summarize(n = n(),
country_na = any(na == 1)) |>
drop_na() |>
group_by(countryname_en) |>
filter(!all(country_na == FALSE)) |>
group_by(countryname_en, imputed) |>
mutate(share = n/sum(n)) |>
ggplot(aes(x = result_trust_bin, y = share, fill = imputed)) +
geom_bar(stat = "identity", position = position_dodge(preserve = "single"),
width = 0.5) +
facet_wrap(~ countryname_en) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 90, hjust = 0.1))
imp1_cmp |>
mutate(na = if_else(is.na(result_trust_bin)[imp == "Observed"] & !is.na(imp == "1"), 1, 0)) |>
filter(na == TRUE | imp == "Observed") |>
group_by(countryname_en, imputed, result_trust_bin) |>
summarize(n = n(),
country_na = any(na == 1)) |>
drop_na() |>
group_by(countryname_en) |>
filter(!all(country_na == FALSE)) |>
group_by(countryname_en, imputed) |>
mutate(share = n/sum(n)) |>
ggplot(aes(x = result_trust_bin, y = share, fill = imputed)) +
geom_bar(stat = "identity", position = position_dodge(preserve = "single"),
width = 0.5) +
facet_wrap(~ countryname_en) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 90, hjust = 1))
imp1_cmp |>
mutate(na = if_else(is.na(sex)[imp == "Observed"] & !is.na(imp == "1"), 1, 0)) |>
filter(na == TRUE | imp == "Observed") |>
group_by(city_en, imputed, sex) |>
summarize(n = n(),
country_na = any(na == 1)) |>
drop_na() |>
group_by(city_en) |>
filter(!all(country_na == FALSE)) |>
group_by(city_en, imputed) |>
mutate(share = n/sum(n)) |>
ggplot(aes(x = sex, y = share, fill = imputed)) +
geom_bar(stat = "identity", position = position_dodge(preserve = "single")) +
facet_grid(~ city_en)
imp1_cmp |>
mutate(na = if_else(is.na(result_trust_bin)[imp == "Observed"] & !is.na(imp == "1"), 1, 0)) |>
filter(na == TRUE | imp == "Observed") |>
group_by(city_en, imputed, result_trust_bin) |>
summarize(n = n(),
country_na = any(na == 1)) |>
drop_na() |>
group_by(city_en) |>
filter(!all(country_na == FALSE)) |>
group_by(city_en, imputed) |>
mutate(share = n/sum(n)) |>
ggplot(aes(x = result_trust_bin, y = share, fill = imputed)) +
geom_bar(stat = "identity", position = position_dodge(preserve = "single"),
width = 0.5) +
facet_wrap(~ city_en) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 90, hjust = 1))
imp1_cmp <- complete(imp1, "long", include = T) |>
mutate(imputed = factor(if_else(`.imp` > 0, 1, 0),
labels = c("Observed", "Imputed")),
imp = factor(if_else(`.imp` == 0, "Observed", as.character(`.imp`))),
city_en = factor(city_en))
View(imp1_cmp)
imp1_cmp <- complete(imp1, "long", include = T) |>
mutate(imputed = factor(if_else(`.imp` > 0, 1, 0),
labels = c("Observed", "Imputed")),
imp = factor(if_else(`.imp` == 0, "Observed", as.character(`.imp`))))
imp1_cmp <- complete(imp1, "long", include = T) |>
mutate(imputed = factor(if_else(`.imp` > 0, 1, 0),
labels = c("Observed", "Average Imputed")),
imp = factor(if_else(`.imp` == 0, "Observed", as.character(`.imp`)))) |>
filter(!countryname_en %in% c("Australia", "New Zealand"))
imp1_cmp |>
group_by(imp) |>
summarize(across(c(sex, age_bin, out_of_Russia_time,
time_to_vs.less_than_hour, time_to_vs.more_than_4hours,
result_trust_bin), ~ sum(is.na(.)))) |>
select(-imp) |>
distinct() |>
rownames_to_column() |>
pivot_longer(cols = c(-rowname)) |>
mutate(name = factor(name,
levels = c("sex", "age_bin", "out_of_Russia_time",
"time_to_vs.less_than_hour",
"time_to_vs.more_than_4hours",
"result_trust_bin"),
labels = c("Sex", "Age", "Time out of Russia",
"Time to voting station < 1 hour",
"Time to voting station > 4 hours",
"Trust in the result")),
rowname = factor(rowname, levels = c(1, 2), labels = c("Imputed",
"Observed"))) |>
ggplot(aes(x = value, y = rowname, fill = rowname)) +
geom_bar(stat = "identity", width = 0.5) +
facet_wrap(~ name, scales = "free_x", ncol = 2) +
scale_fill_manual(values = c("#b3c58b", "#cc4d33")) +
labs(y = NULL, x = "\nNumber of missing values",
title = "Imputation: number of missing values before and after") +
theme_minimal() +
theme(legend.position = "none")
imp1_cmp |>
mutate(na = if_else(is.na(sex)[imp == "Observed"] & !is.na(imp == "1"), 1, 0)) |>
filter(na == TRUE | imp == "Observed") |>
group_by(countryname_en, imputed, sex) |>
summarize(n = n(),
country_na = any(na == 1)) |>
drop_na() |>
group_by(countryname_en) |>
filter(!all(country_na == FALSE)) |>
group_by(countryname_en, imputed) |>
mutate(share = n/sum(n)) |>
ggplot(aes(x = sex, y = share, fill = imputed)) +
geom_bar(stat = "identity", position = position_dodge(preserve = "single")) +
facet_grid(~ countryname_en)
#| label: results
imp1_cmp |>
mutate(na = if_else(is.na(sex)[imp == "Observed"] & !is.na(imp == "1"), 1, 0)) |>
filter(na == TRUE | imp == "Observed") |>
group_by(countryname_en, imputed, sex) |>
summarize(n = n(),
country_na = any(na == 1)) |>
drop_na() |>
group_by(countryname_en) |>
filter(!all(country_na == FALSE)) |>
group_by(countryname_en, imputed) |>
mutate(share = n/sum(n)) |>
ggplot(aes(x = sex, y = share, fill = imputed)) +
geom_bar(stat = "identity", position = position_dodge(preserve = "single")) +
facet_grid(~ countryname_en)
imp1_cmp |>
mutate(na = if_else(is.na(result_trust_bin)[imp == "Observed"] & !is.na(imp == "1"), 1, 0)) |>
filter(na == TRUE | imp == "Observed") |>
group_by(countryname_en, imputed, result_trust_bin) |>
summarize(n = n(),
country_na = any(na == 1)) |>
drop_na() |>
group_by(countryname_en) |>
filter(!all(country_na == FALSE)) |>
group_by(countryname_en, imputed) |>
mutate(share = n/sum(n)) |>
ggplot(aes(x = result_trust_bin, y = share, fill = imputed)) +
geom_bar(stat = "identity", position = position_dodge(preserve = "single"),
width = 0.5) +
facet_wrap(~ countryname_en) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 90, hjust = 1))
imp1_cmp |>
mutate(na = if_else(is.na(result_trust_bin)[imp == "Observed"] & !is.na(imp == "1"), 1, 0)) |>
filter(na == TRUE | imp == "Observed") |>
group_by(countryname_en, imputed, result_trust_bin) |>
summarize(n = n(),
country_na = any(na == 1)) |>
drop_na() |>
group_by(countryname_en) |>
filter(!all(country_na == FALSE)) |>
group_by(countryname_en, imputed) |>
mutate(share = n/sum(n)) |>
ggplot(aes(x = result_trust_bin, y = share, fill = imputed)) +
geom_bar(stat = "identity", position = position_dodge(preserve = "single")) +
facet_wrap(~ countryname_en)
imp1_cmp |>
mutate(na = if_else(is.na(result_trust_bin)[imp == "Observed"] & !is.na(imp == "1"), 1, 0)) |>
filter(na == TRUE | imp == "Observed") |>
group_by(countryname_en, imputed, result_trust_bin) |>
summarize(n = n(),
country_na = any(na == 1)) |>
drop_na() |>
group_by(countryname_en) |>
filter(!all(country_na == FALSE)) |>
group_by(countryname_en, imputed) |>
mutate(share = n/sum(n)) |>
ggplot(aes(x = result_trust_bin, y = share, fill = imputed)) +
geom_bar(stat = "identity", position = position_dodge(preserve = "single"),
width = 0.5) +
facet_wrap(~ countryname_en) +
labs(x = NULL, y = "Share of observations",
title = "Distributions of observed and imputed values",
subtitle =
"Note that in most cases number of imputed values is quite small",
fill = NULL) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
imp1_cmp |>
mutate(na = if_else(is.na(result_trust_bin)[imp == "Observed"] & !is.na(imp == "1"), 1, 0)) |>
filter(na == TRUE | imp == "Observed") |>
group_by(countryname_en, imputed, result_trust_bin) |>
summarize(n = n(),
country_na = any(na == 1)) |>
drop_na() |>
group_by(countryname_en) |>
filter(!all(country_na == FALSE)) |>
group_by(countryname_en, imputed) |>
mutate(share = n/sum(n)) |>
ggplot(aes(x = result_trust_bin, y = share, fill = imputed)) +
geom_bar(stat = "identity", position = position_dodge(preserve = "single")) +
facet_wrap(~ countryname_en, labeller = paste0(countryname_en, n()))
imp1_cmp |>
mutate(na = if_else(is.na(result_trust_bin)[imp == "Observed"] & !is.na(imp == "1"), 1, 0)) |>
filter(na == TRUE | imp == "Observed") |>
group_by(countryname_en, imputed, result_trust_bin) |>
summarize(n = n(),
country_na = any(na == 1)) |>
drop_na() |>
group_by(countryname_en) |>
filter(!all(country_na == FALSE)) |>
group_by(countryname_en, imputed) |>
mutate(share = n/sum(n)) |>
ggplot(aes(x = result_trust_bin, y = share, fill = imputed)) +
geom_bar(stat = "identity", position = position_dodge(preserve = "single")) +
facet_wrap(~ countryname_en)
imp1_cmp |>
mutate(na = if_else(is.na(result_trust_bin)[imp == "Observed"] & !is.na(imp == "1"), 1, 0)) |>
filter(na == TRUE | imp == "Observed") |>
group_by(countryname_en, imputed, result_trust_bin) |>
summarize(n = n(),
country_na = any(na == 1)) |>
drop_na() |>
group_by(countryname_en) |>
filter(!all(country_na == FALSE)) |>
group_by(countryname_en, imputed) |>
mutate(share = n/sum(n)) |>
ggplot(aes(x = result_trust_bin, y = share, fill = imputed)) +
geom_bar(stat = "identity", position = position_dodge(preserve = "single"),
width = 0.5) +
facet_wrap(~ countryname_en) +
labs(x = NULL, y = "Share of observations\n",
title = "Distributions of observed and imputed values",
subtitle =
"Note that in most cases number of imputed values is quite small",
fill = NULL) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
imp1_cmp |>
mutate(na = if_else(is.na(result_trust_bin)[imp == "Observed"] & !is.na(imp == "1"), 1, 0)) |>
filter(na == TRUE | imp == "Observed") |>
group_by(countryname_en, imputed, result_trust_bin) |>
summarize(n = n(),
country_na = any(na == 1)) |>
drop_na() |>
group_by(countryname_en) |>
filter(!all(country_na == FALSE)) |>
group_by(countryname_en, imputed) |>
mutate(share = n/sum(n)) |>
ggplot(aes(x = result_trust_bin, y = share, fill = imputed)) +
geom_bar(stat = "identity", position = position_dodge(preserve = "single"),
width = 0.5) +
facet_wrap(~ countryname_en) +
scale_fill_manual(values = c("#b3c58b", "#cc4d33")) +
labs(x = NULL, y = "Share of observations\n",
title = "Distributions of observed and imputed values",
subtitle =
"Note that in most cases number of imputed values is quite small",
fill = NULL) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
imp1_cmp |>
mutate(na = if_else(is.na(result_trust_bin)[imp == "Observed"] & !is.na(imp == "1"), 1, 0)) |>
filter(na == TRUE | imp == "Observed") |>
group_by(countryname_en, imputed, result_trust_bin) |>
summarize(n = n(),
country_na = any(na == 1)) |>
drop_na() |>
group_by(countryname_en) |>
filter(!all(country_na == FALSE)) |>
group_by(countryname_en, imputed) |>
mutate(share = n/sum(n)) |>
ggplot(aes(x = result_trust_bin, y = share, fill = imputed)) +
geom_bar(stat = "identity", position = position_dodge(preserve = "single"),
width = 0.5) +
facet_wrap(~ countryname_en) +
scale_fill_manual(values = c("#cc4d33", "#b3c58b")) +
labs(x = NULL, y = "Share of observations\n",
title = "Distributions of observed and imputed values",
subtitle =
"Note that in most cases number of imputed values is quite small",
fill = NULL) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
imp1_cmp |>
mutate(na = if_else(is.na(time_to_vs.more_than_4hours)[imp == "Observed"]
& !is.na(imp == "1"), 1, 0)) |>
filter(na == TRUE | imp == "Observed") |>
group_by(countryname_en, imputed, time_to_vs.more_than_4hours) |>
summarize(n = n(),
country_na = any(na == 1)) |>
drop_na() |>
group_by(countryname_en) |>
filter(!all(country_na == FALSE)) |>
group_by(countryname_en, imputed) |>
mutate(share = n/sum(n)) |>
ggplot(aes(x = time_to_vs.more_than_4hours, y = share, fill = imputed)) +
geom_bar(stat = "identity", position = position_dodge(preserve = "single"),
width = 0.5) +
facet_wrap(~ countryname_en) +
scale_fill_manual(values = c("#cc4d33", "#b3c58b")) +
labs(x = NULL, y = "Share of observations\n",
title = "Distributions of observed and imputed values",
subtitle =
"Note that in most cases number of imputed values is quite small",
fill = NULL) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
imp1_cmp |>
mutate(na = if_else(is.na(out_of_Russia_time)[imp == "Observed"] & !is.na(imp == "1"), 1, 0)) |>
filter(na == TRUE | imp == "Observed") |>
group_by(countryname_en, imputed, out_of_Russia_time) |>
summarize(n = n(),
country_na = any(na == 1)) |>
drop_na() |>
group_by(countryname_en) |>
filter(!all(country_na == FALSE)) |>
group_by(countryname_en, imputed) |>
mutate(share = n/sum(n)) |>
ggplot(aes(x = out_of_Russia_time, y = share, fill = imputed)) +
geom_bar(stat = "identity", position = position_dodge(preserve = "single"),
width = 0.5) +
facet_wrap(~ countryname_en) +
scale_fill_manual(values = c("#cc4d33", "#b3c58b")) +
labs(x = NULL, y = "Share of observations\n",
title = "Distributions of observed and imputed values",
subtitle =
"Note that in most cases number of imputed values is quite small",
fill = NULL) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
#| label: results
# Sex
imp1_cmp |>
mutate(na = if_else(is.na(sex)[imp == "Observed"] & !is.na(imp == "1"), 1, 0)) |>
filter(na == TRUE | imp == "Observed") |>
group_by(countryname_en, imputed, sex) |>
summarize(n = n(),
country_na = any(na == 1)) |>
drop_na() |>
group_by(countryname_en) |>
filter(!all(country_na == FALSE)) |>
group_by(countryname_en, imputed) |>
mutate(share = n/sum(n)) |>
ggplot(aes(x = sex, y = share, fill = imputed)) +
geom_bar(stat = "identity", position = position_dodge(preserve = "single"),
width = 0.5) +
facet_wrap(~ countryname_en) +
scale_fill_manual(values = c("#cc4d33", "#b3c58b")) +
labs(x = NULL, y = "Share of observations\n",
title =
"Distributions of observed and imputed values, sex",
subtitle =
"Note that in most cases number of imputed values is quite small",
fill = NULL) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
# Age
imp1_cmp |>
mutate(na = if_else(is.na(age_bin)[imp == "Observed"] & !is.na(imp == "1"), 1, 0)) |>
filter(na == TRUE | imp == "Observed") |>
group_by(countryname_en, imputed, age_bin) |>
summarize(n = n(),
country_na = any(na == 1)) |>
drop_na() |>
group_by(countryname_en) |>
filter(!all(country_na == FALSE)) |>
group_by(countryname_en, imputed) |>
mutate(share = n/sum(n)) |>
ggplot(aes(x = age_bin, y = share, fill = imputed)) +
geom_bar(stat = "identity", position = position_dodge(preserve = "single"),
width = 0.5) +
facet_wrap(~ countryname_en) +
scale_fill_manual(values = c("#cc4d33", "#b3c58b")) +
labs(x = NULL, y = "Share of observations\n",
title =
"Distributions of observed and imputed values, age_bin",
subtitle =
"Note that in most cases number of imputed values is quite small",
fill = NULL) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
# Trust in result
imp1_cmp |>
mutate(na = if_else(is.na(result_trust_bin)[imp == "Observed"]
& !is.na(imp == "1"), 1, 0)) |>
filter(na == TRUE | imp == "Observed") |>
group_by(countryname_en, imputed, result_trust_bin) |>
summarize(n = n(),
country_na = any(na == 1)) |>
drop_na() |>
group_by(countryname_en) |>
filter(!all(country_na == FALSE)) |>
group_by(countryname_en, imputed) |>
mutate(share = n/sum(n)) |>
ggplot(aes(x = result_trust_bin, y = share, fill = imputed)) +
geom_bar(stat = "identity", position = position_dodge(preserve = "single"),
width = 0.5) +
facet_wrap(~ countryname_en) +
scale_fill_manual(values = c("#cc4d33", "#b3c58b")) +
labs(x = NULL, y = "Share of observations\n",
title =
"Distributions of observed and imputed values, Trust in the results",
subtitle =
"Note that in most cases number of imputed values is quite small",
fill = NULL) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
# More than 4
imp1_cmp |>
mutate(na = if_else(is.na(time_to_vs.more_than_4hours)[imp == "Observed"]
& !is.na(imp == "1"), 1, 0)) |>
filter(na == TRUE | imp == "Observed") |>
group_by(countryname_en, imputed, time_to_vs.more_than_4hours) |>
summarize(n = n(),
country_na = any(na == 1)) |>
drop_na() |>
group_by(countryname_en) |>
filter(!all(country_na == FALSE)) |>
group_by(countryname_en, imputed) |>
mutate(share = n/sum(n)) |>
ggplot(aes(x = time_to_vs.more_than_4hours, y = share, fill = imputed)) +
geom_bar(stat = "identity", position = position_dodge(preserve = "single"),
width = 0.5) +
facet_wrap(~ countryname_en) +
scale_fill_manual(values = c("#cc4d33", "#b3c58b")) +
labs(x = NULL, y = "Share of observations\n",
title = "Distributions of observed and imputed values",
subtitle =
"Note that in most cases number of imputed values is quite small",
fill = NULL) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
# Out of Russia
imp1_cmp |>
mutate(na = if_else(is.na(out_of_Russia_time)[imp == "Observed"] & !is.na(imp == "1"), 1, 0)) |>
filter(na == TRUE | imp == "Observed") |>
group_by(countryname_en, imputed, out_of_Russia_time) |>
summarize(n = n(),
country_na = any(na == 1)) |>
drop_na() |>
group_by(countryname_en) |>
filter(!all(country_na == FALSE)) |>
group_by(countryname_en, imputed) |>
mutate(share = n/sum(n)) |>
ggplot(aes(x = out_of_Russia_time, y = share, fill = imputed)) +
geom_bar(stat = "identity", position = position_dodge(preserve = "single"),
width = 0.5) +
facet_wrap(~ countryname_en) +
scale_fill_manual(values = c("#cc4d33", "#b3c58b")) +
labs(x = NULL, y = "Share of observations\n",
title = "Distributions of observed and imputed values",
subtitle =
"Note that in most cases number of imputed values is quite small",
fill = NULL) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
# Age
imp1_cmp |>
mutate(na = if_else(is.na(age_bin)[imp == "Observed"] & !is.na(imp == "1"), 1, 0)) |>
filter(na == TRUE | imp == "Observed") |>
group_by(countryname_en, imputed, age_bin) |>
summarize(n = n(),
country_na = any(na == 1)) |>
drop_na() |>
group_by(countryname_en) |>
filter(!all(country_na == FALSE)) |>
group_by(countryname_en, imputed) |>
mutate(share = n/sum(n))
source(knitr::purl(here::here("scripts", "individual-level", "variables_descriptives.qmd")))
